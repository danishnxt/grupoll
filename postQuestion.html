<!DOCTYPE html>
<html>
<link rel="stylesheet" type="text/css" href="postQuestion.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet"><head>
</head>
<body background="background.jpg">

  <header class="app_header"></header>
  <center>
    <img src="logo.png" class="logo"></img>
    <div class="title1">Post Question</div>
  <div class="what" id="genericText" > What's your question? </div>
  <input id="quesText"  class="inputbar" > </input>

<!--   <div>
    <div class="what"> What is your user ID? </div>
    <input id="userIDText" class="inputbar"> </input>
  </div> -->

  <div>
     <h4 class="how"> How many answers would you like? </h4>
      <select id = "selector" class="qnumber" onChange = "enabler()">
        <option class="optiontxt"> 3 </option>
        <option class="optiontxt"> 2 </option>
      </select>
  </div>

  <div>
    <input id= "option_1" class="answers" > Answer 1 </input>
  </div>
  <div>
    <input id= "option_2" class="answers"> Answer 2 </input>
  </div>
  <div id="third">
    <input id= "option_3" class="answers" disabled = true> Answer 3 </input>
  </div>

  <button class="sendbutton" onClick="send()"> Send question! </button>
  <div class="footer"></div>
  </center>
  </div>
</body>

<script src="/socket.io/socket.io.js"></script>
<script src="/browserfs.min.js"></script>
<script type="text/javascript">
  BrowserFS.install(window)

  BrowserFS.configure({
    fs : "LocalStorage"
  }, e => {
    if (e) {
      throw e
    }
  })

  const switchToQuestion = (questionID) => {
    fs.writeFile('/current_question.txt', questionID, err => {
      if (err) {
        console.log(err)
        alert('Failed to locally store question with ID ' + questionID);
      } else {
        window.open("http://localhost:3000/question", "_self")
      }
    })
  }

  const enabler = () => {
    console.log(document.getElementById("selector").value)
    if (document.getElementById("selector").value === "2") {
      document.getElementById("option_3").disabled = true
      document.getElementById("option_3").style.visibility= "hidden" 
      document.getElementById("third").style.visibility="hidden"

    } else {
      document.getElementById("option_3").disabled = false

    }
  }

  const socket = io()
  const fs = require('fs')

  const myGenericCat = "5adc5269e5ab8524681e7ff5"

  let myUserID = "";

  fs.readFile('/current_user.txt', (err, contents) => {
    myUserID = contents.toString();
  });  

  const send = () => {
    sendValQ = {
      userID: myUserID,
      questionStatement: document.getElementById("quesText").value,
      questionType: false,
      containsImage: false,
      containsVoice: false,
      imageLink: "",
      voiceLink: "",
      date: Date.now(),
      categoryID: myGenericCat,
      answerTimeLimit: Date.now() + 86000000
    }

    socket.emit('msgQuestionPostRequest', sendValQ)
    socket.on('msgQuestionPostRequestConfirmed', payload => {

      if (document.getElementById('option_3').disabled === true){
        ans3 = ""
      } else {
        ans3 = document.getElementById('option_3').value
      }
      sendValA = {
        questionID: payload._id,
        option1: document.getElementById('option_1').value,
        option2: document.getElementById('option_2').value,
        option3: ans3,
        option1Link: "",
        option2Link: "",
        option3Link: ""
      }
      socket.emit('msgAnswerPostRequest', sendValA)
    })

    socket.on('msgQuestionPostRequestRejected', payload => {
      alert('something went terribly wrong :( ')
    })

    socket.on('msgAnswerPostRequestConfirmed', payLoad => {
      switchToQuestion(payLoad.question_id)
    })
  }

</script>
</html>
