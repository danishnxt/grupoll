<!DOCTYPE html>
<html>
<link rel="stylesheet" type="text/css" href="newsfeed.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<head>
	<title> GruPoll </title>
</head>

<body background="background.jpg">
    <center>
      <div id='app_header'></div>
      <div><img id='logo_img' src='logo.png'></div>
      <button id = "option_1" onClick = "postHandle()"> Post Question </button>
	    <ul id= "newsfeed" style="list-style-type:none"></ul>
      <button id = "option_1" onClick= "handleBack()"> Back </button>
      <button id = "option_1" onClick= "handleLogout()"> Logout </button>
      <div> Copyright 2018(c) </div>
    </center>
</body>

<script src="/socket.io/socket.io.js"></script>
<script src="/browserfs.min.js"></script>

<script type="text/javascript">
  BrowserFS.install(window);
  BrowserFS.configure({
    fs : "LocalStorage"
  }, e => {
    if (e) {
      throw e;
    }
  });

  const socket = io();

  const fs = require('fs');

  const postHandle = () => {
    window.open("http://localhost:3000/postQuestion", "_self");
  }

  const handleBack = () => {
    window.open("http://localhost:3000/profile", "_self");
  }

  const handleLogout = () => {
    window.open("http://localhost:3000/splash", "_self");
  }

  const switchToQuestion = (questionID) => {
    console.log(questionID);
    fs.writeFile('/current_question.txt', questionID, err => {
      window.open("http://localhost:3000/question", "_self");
    });
  };

	const addQuestionEntry = (statement, questionID) => {
    const addElem = "<button id=\"option_2\" onclick=\"switchToQuestion('" + questionID + "');\">" + statement + "</button>";
    console.log(addElem);
		document.getElementById("newsfeed").innerHTML += "<li>" + addElem + "</li>";
	};

  socket.on('msgUserFeedRetrieveRequestConfirmed', msg => {
    msg.forEach(val => {
      addQuestionEntry(val.statement, val._id);
    });
  });

  socket.emit('msgUserFeedRetrieveRequest', {});
</script>
</html>
