<!DOCTYPE html>
<html>
<link rel="stylesheet" type="text/css" href="profile.css">
<head>
	<title>Profile</title>
</head>

<body background="background.jpg">
	<center>

		<div id='app_header'></div>
		<div id = 'grupollImage'>
			<center>
				<img id='logo_img' src='logo.png'>
			</center>
		</div>

		<h1 class = "question"> Welcome to GruPoll </h1>
		<div id="profile_picture"> ... loading ... </div>
		<h2 id="name" class = "question">...</h2>

		<div>
			<button id = 'option_1'> Go to Your NewsFeed! </button>
		</div>

	</center>
</body>

<script src="/socket.io/socket.io.js"></script>
<script src="/browserfs.min.js"></script>
<script type="text/javascript">

	BrowserFS.install(window);
	BrowserFS.configure({
		fs : "LocalStorage"
	}, e => {
		if (e) {
			throw e;
		}
	});

	const fs = require('fs');
	const socket = io();
	let userID = "";

	fs.readFile('/current_user.txt', (err, contents) => {
		userID = contents.toString();
	});

	const addName = (userName, firstName, lastName) => {
		document.getElementById('name').innerHTML = firstName + " " + lastName + " (" + userName + ")";
	};

	const addProfilePicture = (profileImage) => {
		document.getElementById('profile_picture').innerHTML = profileImage;
	};

	socket.on('msgUserInitializationConfirmed', user => {
		addName(user.username, user.first_name, user.last_name);
	});

	socket.on('msgUserInitializationRejected', msg => {
		alert('User initialization failed for user with ID ' + userID);
	});

	socket.emit('msgUserInitialization', { userID : userID });

</script>
</html>
